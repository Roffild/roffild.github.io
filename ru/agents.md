---
title: Библиотека Roffild'a
---

Использование агентов тестирования на серверах Амазона.

Отличие от использования облака агентов:
* Фиксированная цена за час и фиксированное количество ядер процессора.
* Возможность использования локальных файлов.
* Возможность использования OpenCL на CPU (и GPU, если инстанс позволяет).
* Закачивать большие файлы, необходимые для тестирования, можно через корзину S3.
* Вероятна возможность использования динамических библиотек (DLL).

Агенты запускаются с флагом "/local", как при локальном использовании.

Затраты при использовании серверов Амазона могут быть гораздо экономичнее, чем при использовании облака агентов.
Расчёт стоимости облако происходит по загадочной формуле, поэтому очень сложно оценить затраты на полную оптимизацию.

Сначала нужно создать корзину на S3 создать папку (МК) и закачать в неё metatester64.exe
Если нужно использовать файлы из папки (файлскомон), то нужно их закачать в (путь указать)

На нужно открыть порты для доступа из вне.
Поскольку сервер будет существовать ограниченнное время и не будет использоваться в публичных целях, то можно не заморачиваться с выбором портов и открыть их все, хоть это и противоречит правилам безопасности.
(здесь картинка с правилами для портов)

В разделе спотинстанс (картинка) нажать на кнопку (название синей кнопки).
Созданный мною скрипт для запуска агентов разчитан на Ubuntu.
![ubuntu](/images/agent-ubuntu.png)
Задать правило открытия портов (картинка портов).
Если использовать заранее созданную роль, то в скрипте не нужно указывать ключ к Амазону.(картинка) (я не проверил)
Если инстанс имеет встроенное дисковое пространство, то количество гигабайтов для EBS задать можно минимум (оплачивается отдельно). (картинка)
Я обычно выбираю инстанс SS8(название) с встроенным SSD на (ГБ). На него часто большая скидка, потому что этот инстанс прошлого поколения, но для агентов тестирования он отлично подходит. (картинка) 

Открываем [aws_ubuntu_user_data.sh](https://github.com/Roffild/RoffildLibrary/blob/master/Include/Roffild/RoffildJava/AmazonUtils/src/main/resources/aws_ubuntu_user_data.sh){:target="_blank"} и вставляем содержимое в "User data".
![User data](/images/agent-userdata.png)<br/>
Hours=1 - ограничивает работу инстанса по количеству часов, потому что оплата почасовая.<br/>
agentStartPort=5000 - начальный порт для 1-ого агента.<br/>
agentPassword=amazon99 - пароль для доступа к агентам.<br/>
bucket= - название корзины, где находятся необходимые для теста файлы.<br/>
Если роль не задана, то придётся указать ключи доступа, чтобы скачать файлы из корзины S3.

Параметр (час) ограничивает работу инстанса по количеству часов, потому что оплата почасовая.
Параметр (корзина) задаёт название корзины S3, --- из которой берётся файл (MT64.exe), --- в который располагается папка (МК) ---
Параметр (регион) указывает регион, в котором находится корзина S3.

После нажатия на кнопку (лауч) произойдёт запрос на создание инстанса.
Инстанс может быть выдан Амазоном с задержкой, поэтому нужно обновлять страницу пока он не появится в списке (картинка).
После этого можно переходить на страницу инстанса и нажать кнопку (коннект) для получения IP. (картинка)
Теперь можно добавить агенты в список для оптимизации в MetaTrader 5 (картинка)
Скрипту нужно время (примерно 5 минут) для запуска агентов в Ubuntu. (картинка с работающими агентами)
